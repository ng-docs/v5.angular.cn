{
  "id": "guide/service-worker-getting-started",
  "title": "Getting started with service workers",
  "contents": "\n<div class=\"content\">\n<h1 id=\"getting-started-with-service-workers\"><a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/service-worker-getting-started#getting-started-with-service-workers\"><i class=\"material-icons\">link</i></a>Getting started with service workers</h1>\n<h4 id=\"prerequisites\"><a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/service-worker-getting-started#prerequisites\"><i class=\"material-icons\">link</i></a>Prerequisites</h4>\n<p>A basic understanding of the following:</p>\n<ul>\n<li><a href=\"guide/service-worker-intro\">Introduction to Angular service workers</a>.</li>\n</ul>\n<hr>\n<p>Beginning in Angular 5.0.0, you can easily enable Angular service worker support in any CLI project. This document explains how to enable Angular service worker support in new and existing projects. It then uses a simple example to show you a service worker in action, demonstrating loading and basic caching.  </p>\n<h2 id=\"adding-a-service-worker-to-a-new-application\"><a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/service-worker-getting-started#adding-a-service-worker-to-a-new-application\"><i class=\"material-icons\">link</i></a>Adding a service worker to a new application</h2>\n<p>If you're generating a new CLI project, you can use the CLI to set up the Angular service worker as part of creating the project. To do so, add the <code>--service-worker</code> flag to the <code>ng new</code>  command:</p>\n<code-example language=\"sh\">\nng new my-project --service-worker \n</code-example>\n<p>The <code>--service-worker</code> flag takes care of configuring your app to\nuse service workers by adding the <code>service-worker</code> package along\nwith setting up the necessary files to support service workers.\nFor information on the details, see the following section\nwhich covers the process in detail as it shows you how to add a\nservice worker manually to an existing app.</p>\n<h2 id=\"adding-a-service-worker-to-an-existing-app\"><a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/service-worker-getting-started#adding-a-service-worker-to-an-existing-app\"><i class=\"material-icons\">link</i></a>Adding a service worker to an existing app</h2>\n<p>To add a service worker to an existing app:</p>\n<ol>\n<li>Add the service worker package.</li>\n<li>Enable service worker build support in the CLI.</li>\n<li>Import and register the service worker.</li>\n<li>Create the service worker configuration file, which specifies the caching behaviors and other settings. </li>\n<li>Build the project.</li>\n</ol>\n<h3 id=\"step-1-add-the-service-worker-package\"><a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/service-worker-getting-started#step-1-add-the-service-worker-package\"><i class=\"material-icons\">link</i></a>Step 1: Add the service worker package</h3>\n<p>Add the package <code>@angular/service-worker</code>, using the yarn utility as shown here:</p>\n<code-example language=\"sh\">\nyarn add @angular/service-worker\n</code-example>\n<h3 id=\"step-2-enable-service-worker-build-support-in-the-cli\"><a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/service-worker-getting-started#step-2-enable-service-worker-build-support-in-the-cli\"><i class=\"material-icons\">link</i></a>Step 2: Enable service worker build support in the CLI</h3>\n<p>To enable the Angular service worker, the CLI must generate an Angular service worker manifest at build time. To cause the CLI to generate the manifest for an existing project, set the <code>serviceWorker</code> flag to <code>true</code> in the project's <code>.angular-cli.json</code> file as shown here:</p>\n<code-example language=\"sh\">\nng set apps.0.serviceWorker=true\n</code-example>\n<h3 id=\"step-3-import-and-register-the-service-worker\"><a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/service-worker-getting-started#step-3-import-and-register-the-service-worker\"><i class=\"material-icons\">link</i></a>Step 3: Import and register the service worker</h3>\n<p>To import and register the Angular service worker:</p>\n<p>At the top of the root module, <code>src/app/app.module.ts</code>, import <code><a href=\"api/service-worker/ServiceWorkerModule\" class=\"code-anchor\">ServiceWorkerModule</a></code> and <code>environment</code>.</p>\n<code-example path=\"service-worker-getting-started/src/app/app.module.ts\" linenums=\"false\" title=\"src/app/app.module.ts\" region=\"sw-import\">\nimport { <a href=\"api/service-worker/ServiceWorkerModule\" class=\"code-anchor\">ServiceWorkerModule</a> } from '@angular/service-worker';\nimport { environment } from '../environments/environment';\n\n</code-example>\n<p>Add <code><a href=\"api/service-worker/ServiceWorkerModule\" class=\"code-anchor\">ServiceWorkerModule</a></code> to the <code>@<a href=\"api/core/NgModule\" class=\"code-anchor\">NgModule</a></code> <code>imports</code> array. Use the <code>register()</code> helper to take care of registering the service worker, taking care to disable the service worker when not running in production mode.</p>\n<code-example path=\"service-worker-getting-started/src/app/app.module.ts\" linenums=\"false\" title=\"src/app/app.module.ts\" region=\"sw-module\">\n@<a href=\"api/core/NgModule\" class=\"code-anchor\">NgModule</a>({\n  declarations: [\n    AppComponent\n  ],\n  imports: [\n    <a href=\"api/platform-browser/BrowserModule\" class=\"code-anchor\">BrowserModule</a>,\n    ServiceWorkerModule.register('/ngsw-worker.js', {enabled: environment.production})\n  ],\n  providers: [\n    CheckForUpdateService,\n    LogUpdateService,\n    PromptUpdateService,\n  ],\n  bootstrap: [AppComponent]\n})\nexport class AppModule { }\n\n</code-example>\n<p>The file <code>ngsw-worker.js</code> is the name of the prebuilt service worker script, which the CLI copies into <code>dist/</code> to deploy along with your server.</p>\n<h3 id=\"step-4-create-the-configuration-file-ngsw-configjson\"><a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/service-worker-getting-started#step-4-create-the-configuration-file-ngsw-configjson\"><i class=\"material-icons\">link</i></a>Step 4: Create the configuration file, <code>ngsw-config.json</code></h3>\n<p>The Angular CLI needs a service worker configuration file, called <code>ngsw-config.json</code>. The configuration file controls how the service worker caches files and data\nresources.</p>\n<p>You can begin with the boilerplate version from the CLI, which configures sensible defaults for most applications.</p>\n<p>Alternately, save the following as <code>src/ngsw-config.json</code>:</p>\n<code-example path=\"service-worker-getting-started/src/ngsw-config.json\" linenums=\"false\" title=\"src/ngsw-config.json\">\n\n{\n  \"index\": \"/index.html\",\n  \"assetGroups\": [{\n    \"name\": \"app\",\n    \"installMode\": \"prefetch\",\n    \"resources\": {\n      \"files\": [\n        \"/favicon.ico\",\n        \"/index.html\"\n      ],\n      \"versionedFiles\": [\n        \"/*.bundle.css\",\n        \"/*.bundle.js\",\n        \"/*.chunk.js\"\n      ]\n    }\n  }, {\n    \"name\": \"assets\",\n    \"installMode\": \"lazy\",\n    \"updateMode\": \"prefetch\",\n    \"resources\": {\n      \"files\": [\n        \"/assets/**\"\n      ]\n    }\n  }]\n}\n\n</code-example>\n<h3 id=\"step-5-build-the-project\"><a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/service-worker-getting-started#step-5-build-the-project\"><i class=\"material-icons\">link</i></a>Step 5: Build the project</h3>\n<p>Finally, build the project: </p>\n<code-example language=\"sh\">\nng build --prod\n</code-example>\n<p>The CLI project is now set up to use the Angular service worker.</p>\n<h2 id=\"service-worker-in-action-a-tour\"><a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/service-worker-getting-started#service-worker-in-action-a-tour\"><i class=\"material-icons\">link</i></a>Service worker in action: a tour</h2>\n<p>This section demonstrates a service worker in action,\nusing an example application. </p>\n<h3 id=\"serving-with-http-server\"><a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/service-worker-getting-started#serving-with-http-server\"><i class=\"material-icons\">link</i></a>Serving with <code>http-server</code></h3>\n<p>Because <code>ng serve</code> does not work with service workers, you must use a seperate HTTP server to test your project locally. You can use any HTTP server. The example below uses the <a href=\"https://www.npmjs.com/package/http-server\">http-server</a> package from npm. To reduce the possibility of conflicts, test on a dedicated port.</p>\n<p>To serve with <code>http-server</code>, change to the directory containing your web files and start the web server: </p>\n<code-example language=\"sh\">\ncd dist\nhttp-server -p 8080\n</code-example>\n<h3 id=\"initial-load\"><a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/service-worker-getting-started#initial-load\"><i class=\"material-icons\">link</i></a>Initial load</h3>\n<p>With the server running, you can point your browser at <a href=\"http://localhost:8080/\">http://localhost:8080/</a>. Your application should load normally.</p>\n<p><strong>Tip:</strong> When testing Angular service workers, it's a good idea to use an incognito or private window in your browser to ensure the service worker doesn't end up reading from a previous leftover state, which can cause unexpected behavior.</p>\n<h3 id=\"simulating-a-network-issue\"><a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/service-worker-getting-started#simulating-a-network-issue\"><i class=\"material-icons\">link</i></a>Simulating a network issue</h3>\n<p>To simulate a network issue, disable network interaction for your application. In Chrome: </p>\n<ol>\n<li>Select <strong>Tools</strong> > <strong>Developer Tools</strong> (from the Chrome menu located at the top right corner).</li>\n<li>Go to the <strong>Network tab</strong>.</li>\n<li>Check the <strong>Offline box</strong>.</li>\n</ol>\n<figure>\n  <img src=\"generated/images/guide/service-worker/offline-checkbox.png\" alt=\"The offline checkbox in the Network tab is checked\" width=\"600\" height=\"62\">\n</figure>\n<p>Now the app has no access to network interaction.</p>\n<p>For applications that do not use the Angular service worker, refreshing now would display Chrome's Internet disconnected page that says \"There is no Internet connection\". </p>\n<p>With the addition of an Angular service worker, the application behavior changes. On a refresh, the page loads normally. </p>\n<p>If you look at the Network tab, you can verify that the service worker is active.</p>\n<figure>\n  <img src=\"generated/images/guide/service-worker/sw-active.png\" alt=\"Requests are marked as from ServiceWorker\" width=\"630\" height=\"112\">\n</figure>\n<p>Notice that under the \"Size\" column, the requests state is <code>(from ServiceWorker)</code>. This means that the resources are not being loaded from the network. Instead, they are being loaded from the service worker's cache.</p>\n<h3 id=\"whats-being-cached\"><a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/service-worker-getting-started#whats-being-cached\"><i class=\"material-icons\">link</i></a>What's being cached?</h3>\n<p>Notice that all of the files the browser needs to render this application are cached. The <code>ngsw-config.json</code> boilerplate configuration is set up to cache the specific resources used by the CLI:</p>\n<ul>\n<li><code>index.html</code>.</li>\n<li><code>favicon.ico</code>.</li>\n<li>Build artifacts (JS and CSS bundles).</li>\n<li>Anything under <code>assets</code>.</li>\n</ul>\n<h3 id=\"making-changes-to-your-application\"><a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/service-worker-getting-started#making-changes-to-your-application\"><i class=\"material-icons\">link</i></a>Making changes to your application</h3>\n<p>Now that you've seen how service workers cache your application, the\nnext step is understanding how updates work. </p>\n<ol>\n<li>\n<p>If you're testing in an incognito window, open a second blank tab. This will keep the incognito and the cache state alive during your test.</p>\n</li>\n<li>\n<p>Close the application tab, but not the window. This should also close the Developer Tools. </p>\n</li>\n<li>\n<p>Shut down <code>http-server</code>.</p>\n</li>\n<li>\n<p>Next, make a change to the application, and watch the service worker install the update.</p>\n</li>\n<li>\n<p>Open <code>src/app/app.component.html</code> for editing.</p>\n</li>\n<li>\n<p>Change the text <code>Welcome to {{title}}!</code> to <code>Bienvenue à {{title}}!</code>.</p>\n</li>\n<li>\n<p>Build and run the server again:</p>\n</li>\n</ol>\n<code-example language=\"sh\">\nng build --prod\ncd dist\nhttp-server -p 8080\n</code-example>\n<h3 id=\"updating-your-application-in-the-browser\"><a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/service-worker-getting-started#updating-your-application-in-the-browser\"><i class=\"material-icons\">link</i></a>Updating your application in the browser</h3>\n<p>Now look at how the browser and service worker handle the updated application.</p>\n<ol>\n<li>Open <a href=\"http://localhost:8080\">http://localhost:8080</a> again in the same window. What happens?</li>\n</ol>\n<figure>\n  <img src=\"generated/images/guide/service-worker/welcome-msg-en.png\" alt=\"It still says Welcome to Service Workers!\" width=\"411\" height=\"248\">\n</figure>\n<p>What went wrong? Nothing, actually. The Angular service worker is doing its job and serving the version of the application that it has <strong>installed</strong>, even though there is an update available. In the interest of speed, the service worker doesn't wait to check for updates before it serves the application that it has cached.</p>\n<p>If you look at the <code>http-server</code> logs, you can see the service worker requesting <code>/ngsw.json</code>. This is how the service worker checks for updates.</p>\n<ol start=\"2\">\n<li>Refresh the page.</li>\n</ol>\n<figure>\n  <img src=\"generated/images/guide/service-worker/welcome-msg-fr.png\" alt=\"The text has changed to say Bienvenue à app!\" width=\"393\" height=\"240\">\n</figure>\n<p>The service worker installed the updated version of your app <em>in the background</em>, and the next time the page is loaded or reloaded, the service worker switches to the latest version.</p>\n<hr>\n<h2 id=\"more-on-angular-service-workers\"><a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/service-worker-getting-started#more-on-angular-service-workers\"><i class=\"material-icons\">link</i></a>More on Angular service workers</h2>\n<p>You may also be interested in the following:</p>\n<ul>\n<li><a href=\"guide/service-worker-communications\">Communicating with service workers</a>.</li>\n</ul>\n\n</div>\n<!-- links to this doc:\n - guide/service-worker-communications\n - guide/service-worker-intro\n-->\n<!-- links from this doc:\n - api/core/NgModule\n - api/platform-browser/BrowserModule\n - api/service-worker/ServiceWorkerModule\n - guide/service-worker-communications\n - guide/service-worker-getting-started#adding-a-service-worker-to-a-new-application\n - guide/service-worker-getting-started#adding-a-service-worker-to-an-existing-app\n - guide/service-worker-getting-started#getting-started-with-service-workers\n - guide/service-worker-getting-started#initial-load\n - guide/service-worker-getting-started#making-changes-to-your-application\n - guide/service-worker-getting-started#more-on-angular-service-workers\n - guide/service-worker-getting-started#prerequisites\n - guide/service-worker-getting-started#service-worker-in-action-a-tour\n - guide/service-worker-getting-started#serving-with-http-server\n - guide/service-worker-getting-started#simulating-a-network-issue\n - guide/service-worker-getting-started#step-1-add-the-service-worker-package\n - guide/service-worker-getting-started#step-2-enable-service-worker-build-support-in-the-cli\n - guide/service-worker-getting-started#step-3-import-and-register-the-service-worker\n - guide/service-worker-getting-started#step-4-create-the-configuration-file-ngsw-configjson\n - guide/service-worker-getting-started#step-5-build-the-project\n - guide/service-worker-getting-started#updating-your-application-in-the-browser\n - guide/service-worker-getting-started#whats-being-cached\n - guide/service-worker-intro\n - http://localhost:8080\n - http://localhost:8080/\n - https://www.npmjs.com/package/http-server\n-->"
}