{
  "id" : "guide/service-worker-communications",
  "title" : "Service Worker 通信",
  "contents" : "<div class=\"content\">\n<h1 id=\"service-worker-communication\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"1ovwrtsbwtuidl6m4atizx0ih\"><i class=\"material-icons\">link</i>Service Worker 通信</h1>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"4mmx9lbffyoh0eez3ma382ram\">将 \n<code><a href=\"api/service-worker/ServiceWorkerModule\" class=\"code-anchor\">ServiceWorkerModule</a></code> 导入到你的 \n<code>AppModule</code> 中不仅会注册 Service Worker，还会提供一些服务，你可以使用这些服务与 Service Worker 交互并控制应用程序的缓存。</p>\n<h4 id=\"prerequisites\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"e44b21uig1fakj5vcfuvz1bdu\"><i class=\"material-icons\">link</i>先决条件</h4>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"3xq8keqzpcinu80uje7xu3rbf\">对以下内容的基本了解：</p>\n<ul>\n<li data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"1wki63ca8t4qc4y7iqm2s755t\"><a href=\"guide/service-worker-getting-started\">Service Worker 入门</a>。</li>\n</ul>\n<hr>\n<h2 id=\"swupdate-service\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"eks0azqz0vyr2la4zfbtos7gt\"><i class=\"material-icons\">link</i><code><a href=\"api/service-worker/SwUpdate\" class=\"code-anchor\">SwUpdate</a></code> 服务</h2>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"cs9ggfxi22nkujga8qksb7juc\"><code><a href=\"api/service-worker/SwUpdate\" class=\"code-anchor\">SwUpdate</a></code> 服务使你可以访问指示 Service Worker 何时发现应用程序的可用更新或何时激活此类更新的事件，这意味着它现在正在向你的应用程序提供来自该更新的内容。</p>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"aprkk2sfbaisr03rcbb3r1ne6\"><code><a href=\"api/service-worker/SwUpdate\" class=\"code-anchor\">SwUpdate</a></code> 服务支持四种独立的操作：</p>\n<ul>\n<li data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"a11ng87oogc4r80x6tzliadah\">接收\n<em>可用</em>更新的通知。这些是应用程序的新版本，如果刷新页面，则会加载这些版本。</li>\n<li data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"amdyz2ojd6zlljjturl2q127t\">接收更新\n<em>激活</em>的通知。这是 Service Worker 开始立即提供应用程序新版本的时间。</li>\n<li data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"78k1ael42rawv8yjuyyp92pyf\">要求 Service Worker 检查服务器是否有新更新。</li>\n<li data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"6f5b2s7b00hgzbwsa7ykxd542\">要求 Service Worker 为当前选项卡激活应用程序的最新版本。</li>\n</ul>\n<h3 id=\"available-and-activated-updates\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"6zwwwa3eqnv59ase5f5q6u94g\"><i class=\"material-icons\">link</i>可用更新和已激活更新</h3>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"9y1xopcn4w4ugfcnz118zk3g3\">两个更新事件 \n<code>available</code> 和 \n<code>activated</code> 是 \n<code><a href=\"api/service-worker/SwUpdate\" class=\"code-anchor\">SwUpdate</a></code> 的 \n<code>Observable</code> 属性：</p>\n<code-example path=\"service-worker-getting-started/src/app/log-update.service.ts\" linenums=\"false\" title=\"log-update.service.ts\" region=\"sw-update\">\n@<a href=\"api/core/Injectable\" class=\"code-anchor\">Injectable</a>()\nexport class LogUpdateService {\n\n  constructor(updates: <a href=\"api/service-worker/SwUpdate\" class=\"code-anchor\">SwUpdate</a>) {\n    updates.available.subscribe(event =&gt; {\n      console.log('current version is', event.current);\n      console.log('available version is', event.available);\n    });\n    updates.activated.subscribe(event =&gt; {\n      console.log('old version was', event.previous);\n      console.log('new version is', event.current);\n    });\n  }\n}\n\n</code-example>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"71qogznckvxnc3f0g9ndzhp0r\">你可以使用这些事件来通知用户有待处理的更新，或者在他们运行的代码已过时时刷新他们的页面。</p>\n<h3 id=\"checking-for-updates\" data-ng_translator_product=\"100\" data-ng_translator_confirmed data-ng_translator_ref_id=\"br7lytwh2mmd44y1dbrfrfrbm\"><i class=\"material-icons\">link</i>检查更新</h3>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"1l1ml8k3xj6h44a0d3i7kkgs9\">可以要求服务工作者检查服务器上是否已部署任何更新。如果你的网站经常更改，或者希望按计划进行更新，你可能会选择这样做。</p>\n<p data-ng_translator_product=\"100\" data-ng_translator_confirmed data-ng_translator_ref_id=\"eqxqfrgt6wk0zkwxv71wfporm\">通过调用 <code>checkForUpdate()</code> 方法来实现：</p>\n<code-example path=\"service-worker-getting-started/src/app/check-for-update.service.ts\" linenums=\"false\" title=\"check-for-update.service.ts\" region=\"sw-check-update\">\nimport { interval } from 'rxjs/observable/interval';\n\n@<a href=\"api/core/Injectable\" class=\"code-anchor\">Injectable</a>()\nexport class CheckForUpdateService {\n\n  constructor(updates: <a href=\"api/service-worker/SwUpdate\" class=\"code-anchor\">SwUpdate</a>) {\n    interval(6 * 60 * 60).subscribe(() =&gt; updates.checkForUpdate());\n  }\n}\n\n</code-example>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"122mm8d5h7kh9daihbqgvk7t8\">此方法返回一个 \n<code>Promise</code>，表示更新检查已成功完成，但它不表示检查结果是否发现了更新。即使发现更新，服务工作者也必须成功下载更改后的文件，这可能会失败。如果成功，\n<code>available</code> 事件将指示应用的新版本可用。</p>\n<h3 id=\"forcing-update-activation\" data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"4nm4u0hiaa9vdkvkujme81zf8\"><i class=\"material-icons\">link</i>强制更新激活</h3>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"5f6df0s08df6p5sf69jfmf3k0\">如果当前标签需要立即更新到最新应用版本，它可以使用 \n<code>activateUpdate()</code> 方法请求这样做：</p>\n<code-example path=\"service-worker-getting-started/src/app/prompt-update.service.ts\" linenums=\"false\" title=\"prompt-update.service.ts\" region=\"sw-activate\">\n@<a href=\"api/core/Injectable\" class=\"code-anchor\">Injectable</a>()\nexport class PromptUpdateService {\n\n  constructor(updates: <a href=\"api/service-worker/SwUpdate\" class=\"code-anchor\">SwUpdate</a>) {\n    updates.available.subscribe(event =&gt; {\n      if (promptUser(event)) {\n        updates.activateUpdate().then(() =&gt; document.location.reload());\n      }\n    });\n  }\n}\n\n</code-example>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"ecqjzf15m0241hahpcs0lnncs\">这样做可能会破坏正在运行的应用的惰性加载，尤其是当惰性加载的块使用带有哈希的文件名时，这些文件名在每个版本中都会发生变化。</p>\n<h2 id=\"more-on-angular-service-workers\" data-ng_translator_product=\"100\" data-ng_translator_confirmed data-ng_translator_ref_id=\"e9jl51v338pdg88lkv1cl8f1i\"><i class=\"material-icons\">link</i>关于 Angular Service Worker 的更多信息</h2>\n<p data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"320pd4quk21g01cifflgmc0pj\">你可能还会对以下内容感兴趣：</p>\n<ul>\n<li data-ng_translator_product=\"100\" data-ng_translator_ref_id=\"3iyhol8jsafrwwg3fbgeoz1jt\"><a href=\"guide/service-worker-devops\">生产环境中的服务工作者</a>.</li>\n</ul>\n\n</div>\n<!-- links to this doc:\n - guide/service-worker-devops\n - guide/service-worker-getting-started\n-->\n<!-- links from this doc:\n - api/core/Injectable\n - api/service-worker/ServiceWorkerModule\n - api/service-worker/SwUpdate\n - guide/service-worker-communications#available-and-activated-updates\n - guide/service-worker-communications#checking-for-updates\n - guide/service-worker-communications#forcing-update-activation\n - guide/service-worker-communications#more-on-angular-service-workers\n - guide/service-worker-communications#prerequisites\n - guide/service-worker-communications#service-worker-communication\n - guide/service-worker-communications#swupdate-service\n - guide/service-worker-devops\n - guide/service-worker-getting-started\n-->"
}